resources:
  - repo: self

phases:
  - phase: Phase_1
    displayName: Linux
    condition: succeeded()
    queue:
      name: Hosted Ubuntu 1604

    steps:
      - template: build-nix.yml

      - task: PublishBuildArtifacts@1
        displayName: 'Publish Artifact: Linux'
        inputs:
          PathtoPublish: '_platformrelease'
          ArtifactName: Linux

  - phase: Phase_3
    displayName: macOS
    condition: succeeded()
    queue:
      name: Hosted macOS
      demands: node.js

    steps:
      - template: build-nix.yml

      - task: PublishBuildArtifacts@1
        displayName: 'Publish Artifact: macOS'
        inputs:
          PathtoPublish: '_platformrelease'
          ArtifactName: macOS

  - phase: Phase_2
    displayName: Windows
    condition: succeeded()
    queue:
      name: Hosted VS2017
      demands: npm

    steps:
      - template: build-windows.yml

      - task: PublishBuildArtifacts@1
        displayName: 'Publish Artifact: Windows'
        inputs:
          PathtoPublish: '_platformrelease'
          ArtifactName: Windows
