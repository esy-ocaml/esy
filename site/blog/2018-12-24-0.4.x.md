---
author: Andrey Popp
authorURL: https://twitter.com/andreypopp
title: What's new in esy 0.4.x
---

This is the first post on esy dev blog finally breaking the radio silence which
we kept while writing lots and lots of code to make esy work.

<!--truncate-->

## What's esy

If you've stumbled upon this and don't know what esy is: esy is a
"package.json"-like workflow for native development.

We are focusing on Reason/OCaml first but the concept is sound for almost any
native code (we already use it to package and distribute C/C++ too).

One could say that esy is an Silver Bul^W universal package management workflow.
More seriously, why you'd want to use esy:

- esy is not tied to any particular choice of a language/platform. Though we are
  focusing on Reason/OCaml first as said above.

- esy is agnostic to a choice of build system: you don't have to port a project
  to some specific build system to make it work with esy.

- esy tries to provide "hermetic" builds so that builds of packages are
  unaffected by the system software installed at global paths: if it works on my
  machine then it should work on yours.

- esy caches built artifacts for across projects: with warm cache a new project
  is cheap to initialise & build.

This is not an exhaustive list of esy features but we think these are the most
important points.

## esy 0.4.x

Now let's get to the topic of the blog post.

We recently promoted the 0.4.8 release of esy as `latest`. That means if you
execute:

```shell
% npm install -g esy
```

You'll get `esy@0.4.8` which is packed with new features. Below we discuss some
of those.

### Plug'n'play Installations

**TL;DR:** esy won't populate `node_modules` directory with package sources
anymore, instead using global cache directly. Compatibility with JS packages is
preserved through the support for Plug'n'play pioneered by [yarn][].

As `esy install` command was started as a fork of yarn back then we were using a
standard `node_modules` layout for fetched packages.

The nice thing about this is that we are compatible with NodeJs, Webpack and
similar runtimes: that in turn means that one can manage both native packages and
JavaScript packages with the single package manager &mdash; esy.

The downside of that approach is that keeping fetched sources in a local
`node_modules` dir isn't needed for native packages.

Thus for native packages (the main focus of esy) it's just wasteful of disk
space and slows esy down as we have to copy sources over from cache to a
`node_modules` dir.

Moreover and most importantly it's not safe to expose sources of native packages
that way &mdash; one could easily modify package sources inside `node_modules`
by mistake and then run `esy build` which will "commit" those changes to the
global build store which is shared across different projects.

So how esy can keep the nice thing (being compatible with JS runtimes) and
prevent bad things to happen (taint the global build cache)?

Fortunately yarn team figured out how to ditch `node_modules` for JS code too
&mdash; they designed a new feature called [Plug'n'play installations][pnp] (pnp
for short). You can read about it in depth in the linked article but... pnp is
way to install JS packages in the global location and then make Node, Webpack
and other runtimes to be able to resolve code from there.

As you can guess pnp is a big win for esy.

esy adopted the `node_modules`-less Plug'n'play installation model in 0.4.x.

There's no more `node_modules` dir populated with packages sources and thus
installations with a warm cache are fast. Like really fast:

```shell
% time esy install
info install 0.4.7
info fetching: done
info installing: done
esy install  0.24s user 0.16s system 120% cpu 0.335 total
```

esy is still compatible with JS packages thanks to work of yarn team who made
sure the most important bits of JS ecosystem work with pnp: webpack, jest, flow,
react-scripts, rollup, prettier and others.

The workflow for working with JS (non-native) packages with esy looks like this:

- Execute pnp-enabled NodeJs interpreter:

  ```shell
  % esy node
  ```
- Execute npm binaries installed with packages like webpack, flow, jest and
  similar:

  ```shell
  % esy webpack
  % esy flow
  % esy jest
  ```

### Alpha preview of Windows support

Another huge feature which shipped in 0.4.x is Windows support. Yes &mdash; esy
works on Windows and produces native binaries.

Thanks to heroic effots of [Bryan Phelps][bryphe] and foundational work made by
OCaml community developing Reason/OCaml native projects on Windows is now as
easy as on macOS/Linux:

```shell
C:\Users\Andrey> git clone https://github.com/facebook/reason
C:\Users\Andrey> cd reason
C:\Users\Andrey> esy
info install 0.4.8
info fetching: done
info installing: done
```

There is more to say about how Windows support is implemented in esy and we will
make sure there's a decicated post on this in the near future.

Note though that Windows support is still considered alpha &mdash; there are
rough edges which needs to be fixed. If you are a developer who works on Windows
and want to help &mdash; jump into [esy/esy issues labelled
"Windows"][win-issues] and help us! The good thing is that we have CI running on
Windows too (besides macOS & Linux).

### Other 0.4.x goodies

There are lots and lots of changes in 0.4.x release line. I even think we've got
a little bit too much with keeping 0.4.x as `next`. Further we are aiming for
more incremental releases.

Anyways, as I said there are lots of changes. One would better consult the
[CHANGELOG][] but just to highlight a few:

- Improved workflow for linked packages: working on multiple packages in
  development is now more efficient and esy allows more flexibility in how you
  organize your project.

- Support for multiple isolated environment constructed on the fly from package
  configs:

  ```shell
  % esy @package.dev.json build
  ```

- Flexible package override mechanism which allows to turn any source code
  distribution into an esy package and bring it into your project with all usual
  benefits of esy workflow: cached builds, isolated environments, ...

  ```json
  {
    "resolutions": {
      "pkg-config": {
        "source": "https://...",
        "override": {
          "build": [
            "./configure --prefix #{self.install}",
            "make"
          ],
          "install": [
            "make install"
          ]
        }
        "
      }
    }
  ```

- Numerous improvements to esy's user interface: new commands (`esy show` and
  `esy status`), faster `esy x ...` command invocations, a new set of low level
  plumbing commands for "scriptable" esy workflows, ...

- New `esy.lock` format which is easier to review on updates.

- Bug fixes, bug fixes, bug fixes, ...

Some of these features are not documented yet properly but we'll make sure we do
this and then post updates on this blog.

Stay tuned!

[pnp]: https://github.com/arcanis/rfcs/blob/6fc13d52f43eff45b7b46b707f3115cc63d0ea5f/accepted/0000-plug-an-play.md
[yarn]: http://yarnpkg.com/
[bryphe]: https://github.com/bryphe
[win-issues]: https://github.com/esy/esy/issues?q=is%3Aissue+is%3Aopen+label%3Awindows
[CHANGELOG]: https://github.com/esy/esy/blob/496923fce0412f1e3e81ebfa8797a4e09f28ecd4/CHANGELOG.md#048--latest
